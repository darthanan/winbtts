name: Atualiza√ß√£o Di√°ria de Tips e Hist√≥rico

on:
  schedule:
    - cron: '0 12 * * *' # Roda √†s 09:00 BRT
  workflow_dispatch: # Permite que voc√™ rode manualmente para testar

jobs:
  build:
    runs-on: ubuntu-latest
    # PASSO IMPORTANTE: Permiss√£o para o rob√¥ escrever no seu reposit√≥rio
    permissions:
      contents: write
    
    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v3

      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar depend√™ncias
        run: |
          pip install -U google-generativeai
          pip install requests

      - name: Rodar script de atualiza√ß√£o inteligente
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          FOOTBALL_API_KEY: ${{ secrets.FOOTBALL_API_KEY }}
        run: python update_tips.py

      - name: Salvar mudan√ßas (Commit & Push)
        run: |
          git config --global user.name 'AI-Market-Bot'
          git config --global user.email 'bot@tipsia.com'
          git add index.html historico.json
          # O '|| exit 0' evita que o erro de "nada para commitar" pare o processo
          git commit -m "ü§ñ Automa√ß√£o: Odds e Hist√≥rico atualizados [$(date +'%d/%m/%Y')]" || exit 0
          git push
